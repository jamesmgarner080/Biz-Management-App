{'role': 'assistant', 'content': '<function_calls>\n<create-file file_path="database/add_permissions.sql">\n-- Add permissions table for feature-based access control\nCREATE TABLE IF NOT EXISTS user_permissions (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    user_id INTEGER NOT NULL,\n    permission TEXT NOT NULL,\n    granted_by INTEGER NOT NULL,\n    granted_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n    FOREIGN KEY (user_id) REFERENCES users(id),\n    FOREIGN KEY (granted_by) REFERENCES users(id),\n    UNIQUE(user_id, permission)\n);\n\n-- Role permissions table for default role-based permissions\nCREATE TABLE IF NOT EXISTS role_permissions (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    role TEXT NOT NULL,\n    permission TEXT NOT NULL,\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n    UNIQUE(role, permission)\n);\n\n-- Insert default role permissions\n-- Admin has all permissions\nINSERT OR IGNORE INTO role_permissions (role, permission) VALUES\n(\'admin\', \'view_all_tasks\'),\n(\'admin\', \'create_tasks\'),\n(\'admin\', \'edit_tasks\'),\n(\'admin\', \'delete_tasks\'),\n(\'admin\', \'assign_tasks\'),\n(\'admin\', \'complete_tasks\'),\n(\'admin\', \'view_all_users\'),\n(\'admin\', \'create_users\'),\n(\'admin\', \'edit_users\'),\n(\'admin\', \'delete_users\'),\n(\'admin\', \'manage_permissions\'),\n(\'admin\', \'view_schedules\'),\n(\'admin\', \'create_schedules\'),\n(\'admin\', \'edit_schedules\'),\n(\'admin\', \'delete_schedules\'),\n(\'admin\', \'generate_reports\'),\n(\'admin\', \'view_analytics\'),\n(\'admin\', \'manage_templates\');\n\n-- Manager permissions\nINSERT OR IGNORE INTO role_permissions (role, permission) VALUES\n(\'manager\', \'view_all_tasks\'),\n(\'manager\', \'create_tasks\'),\n(\'manager\', \'edit_tasks\'),\n(\'manager\', \'assign_tasks\'),\n(\'manager\', \'complete_tasks\'),\n(\'manager\', \'view_all_users\'),\n(\'manager\', \'view_schedules\'),\n(\'manager\', \'create_schedules\'),\n(\'manager\', \'edit_schedules\'),\n(\'manager\', \'generate_reports\'),\n(\'manager\', \'view_analytics\');\n\n-- Supervisor permissions\nINSERT OR IGNORE INTO role_permissions (role, permission) VALUES\n(\'supervisor\', \'view_all_tasks\'),\n(\'supervisor\', \'create_tasks\'),\n(\'supervisor\', \'assign_tasks\'),\n(\'supervisor\', \'complete_tasks\'),\n(\'supervisor\', \'view_schedules\'),\n(\'supervisor\', \'generate_reports\');\n\n-- Bar Staff permissions\nINSERT OR IGNORE INTO role_permissions (role, permission) VALUES\n(\'bar_staff\', \'view_my_tasks\'),\n(\'bar_staff\', \'complete_tasks\'),\n(\'bar_staff\', \'view_my_schedule\');\n\n-- Cleaner permissions\nINSERT OR IGNORE INTO role_permissions (role, permission) VALUES\n(\'cleaner\', \'view_my_tasks\'),\n(\'cleaner\', \'complete_tasks\'),\n(\'cleaner\', \'view_my_schedule\');\n\n-- Employee permissions (general)\nINSERT OR IGNORE INTO role_permissions (role, permission) VALUES\n(\'employee\', \'view_my_tasks\'),\n(\'employee\', \'complete_tasks\'),\n(\'employee\', \'view_my_schedule\');\n\n-- Create index for faster permission lookups\nCREATE INDEX IF NOT EXISTS idx_user_permissions_user ON user_permissions(user_id);\nCREATE INDEX IF NOT EXISTS idx_role_permissions_role ON role_permissions(role);\n</create-file>\n</function_calls>'}