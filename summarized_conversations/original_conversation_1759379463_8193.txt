{'role': 'assistant', 'content': 'Now let\'s update the auth middleware to support the new permission system:\n\n<function_calls>\n<str-replace file_path="backend/auth.js">\n<old_str>// Middleware to check if user is management\nfunction requireManagement(req, res, next) {\n    if (req.user.role !== \'management\') {\n        return res.status(403).json({ error: \'Management access required\' });\n    }\n    next();\n}</old_str>\n<new_str>// Middleware to check if user is management (admin or manager)\nfunction requireManagement(req, res, next) {\n    if (![\'admin\', \'manager\'].includes(req.user.role)) {\n        return res.status(403).json({ error: \'Management access required\' });\n    }\n    next();\n}\n\n// Middleware to check if user is admin\nfunction requireAdmin(req, res, next) {\n    if (req.user.role !== \'admin\') {\n        return res.status(403).json({ error: \'Admin access required\' });\n    }\n    next();\n}\n\n// Middleware to check specific permission\nfunction requirePermission(permission) {\n    return (req, res, next) => {\n        const db = req.app.get(\'db\');\n        if (!db.hasPermission(req.user.id, permission)) {\n            return res.status(403).json({ error: `Permission required: ${permission}` });\n        }\n        next();\n    };\n}</new_str>\n</str-replace>\n</function_calls>'}